var T=Object.defineProperty;var $=(s,t,a)=>t in s?T(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var b=(s,t,a)=>$(s,typeof t!="symbol"?t+"":t,a);import{r as h,j as e,c as W,R as z}from"./client-BW4HFQ8H.js";function P(){return new Date().toLocaleDateString("en-US")}class R{constructor(t){b(this,"read");b(this,"title");b(this,"url");b(this,"datePublished");b(this,"dateRead");this.read=t.isRead,this.title=t.title,this.url=t.url,this.datePublished=t.datePublished,this.dateRead=t.dateRead}static empty(){return R.new("No Chapter",null)}static new(t,a,n){return new R({title:t,isRead:!1,url:a,datePublished:n||P(),dateRead:null})}toggle(){this.read?(this.read=!1,this.dateRead=null):(this.read=!0,this.dateRead=P())}openLink(){this.url&&(this.read||(this.read=!0,this.dateRead=P()),window.electronAPI.openExternal(this.url))}serialize(){return{title:this.title,isRead:this.read,url:this.url,datePublished:this.datePublished,dateRead:this.dateRead}}}class U{constructor(t){b(this,"title");b(this,"coverRelativePath");b(this,"coverPath");b(this,"summary");b(this,"homepageURL");b(this,"checkForUpdates");b(this,"additionalInfo");b(this,"chapters");this.title=t.title,this.coverRelativePath=t.coverImage,this.coverPath=t.coverImage,this.summary=t.summary,this.homepageURL=t.homepageURL,this.checkForUpdates=t.checkForUpdates,this.additionalInfo=t.additionalInfo,this.chapters=t.chapters.map(a=>new R(a))}static empty(){return new U({title:"No Story",coverImage:"",summary:"",homepageURL:"",checkForUpdates:!1,chapters:[]})}async setCover(){this.coverPath=await window.electronAPI.getImageUrl(this.coverRelativePath)}editStory(t){t.title&&(this.title=t.title),t.coverImage&&(this.coverRelativePath=t.coverImage,this.setCover()),t.summary&&(this.summary=t.summary),t.homepageURL&&(this.homepageURL=t.homepageURL),t.checkForUpdates!==void 0&&(this.checkForUpdates=t.checkForUpdates)}finished(){return this.chapters.every(t=>t.read)}getLastKnownChapter(){return this.chapters.length===0?R.empty():this.chapters[this.chapters.length-1]}getLastReadChapter(){if(this.chapters.length===0)return R.empty();for(let t=this.chapters.length-1;t>=0;t--)if(this.chapters[t].read)return this.chapters[t];return R.empty()}getFirstUnread(){return this.chapters.find(a=>!a.read)||null}newChapters(t){this.chapters.push(...t)}addChapter(t,a){this.chapters.splice(a,0,t)}serialize(){const t={title:this.title,coverImage:this.coverRelativePath,homepageURL:this.homepageURL,summary:this.summary,checkForUpdates:this.checkForUpdates,chapters:this.chapters.map(a=>a.serialize())};return this.additionalInfo!==void 0&&(t.additionalInfo=this.additionalInfo),t}}class L{constructor(){b(this,"stories");this.stories=[]}static async create(){let t;try{t=await window.electronAPI.loadLibrary()}catch(n){if(n.code==="ENOENT")t=[];else throw n}const a=new L;return a.stories=t.map(n=>new U(n)),a.stories.forEach(n=>n.setCover()),a}async saveLibrary(){await window.electronAPI.saveLibrary(this.stories.map(t=>t.serialize())),console.log("Saved Successfully")}getStory(t){return this.stories.find(a=>a.title===t)}deleteStory(t){const a=this.stories.indexOf(t);a!==-1&&this.stories.splice(a,1)}addStory(t){this.stories.push(t)}grid(){const t=[];let a=0;for(const n of this.stories)n.finished()?t.push(n):n.checkForUpdates?(t.unshift(n),a++):t.splice(a,0,n);return t}serialize(){return this.stories.map(t=>t.serialize())}}const I=h.createContext(null),M=({children:s})=>{const[t,a]=h.useState(new L),n=async()=>{const o=await L.create();return a(o),o},r=async()=>{await t.saveLibrary()};return e.jsx(I.Provider,{value:{library:t,loadLibrary:n,updateLibrary:r},children:s})},D=()=>{const s=h.useContext(I);if(!s)throw new Error("useLibrary must be used within a LibraryProvider");return s},O=({onSave:s,onCancel:t,totalChapters:a})=>{const[n,r]=h.useState(""),[o,l]=h.useState(""),[i,d]=h.useState("last"),[u,c]=h.useState(a+1),[w,C]=h.useState(""),k=p=>{if(!p)return"";const v=new Date(p),x=(v.getMonth()+1).toString(),j=(v.getDate()+1).toString(),g=v.getFullYear();return`${x}/${j}/${g}`},N=p=>{p.preventDefault();const v=R.new(n,o||null,k(w));s(v,i==="custom"?u-1:i==="last"?a:0)};return e.jsxs("div",{className:"add-chapter-form",children:[e.jsx("h3",{children:"Add New Chapter"}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Chapter Title*:"}),e.jsx("input",{type:"text",value:n,onChange:p=>r(p.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"URL:"}),e.jsx("input",{type:"url",value:o,onChange:p=>l(p.target.value),placeholder:"Optional"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Position:"}),e.jsxs("div",{className:"position-options",children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",checked:i==="first",onChange:()=>d("first")}),"First"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",checked:i==="last",onChange:()=>d("last")}),"Last"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",checked:i==="custom",onChange:()=>d("custom")}),"Custom:"]}),i==="custom"&&e.jsx("input",{type:"number",min:"1",max:a+1,value:u,onChange:p=>c(parseInt(p.target.value)),className:"custom-position-input"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date Published:"}),e.jsx("input",{type:"date",onChange:p=>C(p.target.value)})]}),e.jsxs("div",{className:"form-buttons",children:[e.jsx("button",{type:"button",onClick:t,className:"cancel-button",children:"Cancel"}),e.jsx("button",{type:"submit",className:"save-button",children:"Save Chapter"})]})]})]})},Y=({story:s,onEdit:t,refreshGrid:a})=>{const[n,r]=h.useState(!1),[o,l]=h.useState(!1),[i,d]=h.useState(!1),[u,c]=h.useState(!1),{updateLibrary:w}=D(),C=()=>{l(!o),a(),w()},k=m=>{m.toggle(),C()},N=m=>{m.openLink(),C()},p=()=>{c(!0)},v=m=>{const S=s.chapters.indexOf(m);S!==-1&&(s.chapters.splice(S,1),C())},x=()=>{d(!i)},j=m=>{i||(s.chapters.forEach(S=>{S.read!==m&&S.toggle()}),C())},g=(m,S)=>{s.addChapter(m,S),C(),c(!1)},f=()=>{c(!1)},y=s.chapters.every(m=>m.read);return e.jsxs("div",{className:"detail-story-panel",children:[e.jsxs("div",{className:"cover-row",children:[s.coverPath?e.jsx("img",{src:`${s.coverPath}`,alt:"Cover",className:"cover-image",onError:m=>{const S=m.target;S.onerror=null,S.src="",S.className="cover-placeholder"}}):e.jsx("div",{className:"cover-placeholder",children:"[Cover not found]"}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{onClick:()=>t(),className:"action-button",children:"✏️ Edit"}),e.jsx("button",{onClick:()=>r(!n),className:"action-button",children:"📖 Chapters"}),s.homepageURL&&e.jsx("button",{onClick:()=>window.electronAPI.openExternal(s.homepageURL),className:"action-button",children:"Homepage"})]})]}),e.jsxs("div",{className:"story-details",children:[e.jsxs("h2",{className:"story-title",children:[s.title,!s.checkForUpdates&&e.jsx("span",{className:"not-updating",children:" (Not Updating)"})]}),e.jsx("p",{className:"story-summary",children:s.summary})]}),n&&e.jsx("div",{className:"chapters-section",children:u?e.jsx(O,{onSave:g,onCancel:f,totalChapters:s.chapters.length}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"chapters-header",children:[e.jsx("h3",{children:"Chapters:"}),!i&&e.jsx("button",{onClick:()=>j(!y),className:"chapters-action-button",children:y?"UNREAD ALL":"READ ALL"}),!i&&e.jsx("button",{onClick:p,className:"chapters-action-button",children:"Add Chapter"}),e.jsx("button",{onClick:x,className:`chapters-action-button ${i?"delete-mode-active":""}`,children:i?"Cancel Delete":"Delete Chapter"})]}),e.jsx("div",{className:"chapters-list",children:[...s.chapters].reverse().map((m,S)=>e.jsxs("div",{className:"chapter-item",children:[e.jsx("button",{onClick:()=>i?v(m):k(m),className:`chapter-toggle ${i?"delete-mode":""}`,children:i?"🗑️":m.read?"✓":"✗"}),e.jsx("span",{className:`chapter-title ${m.url?"has-link":""}`,onClick:()=>m.url&&!i&&N(m),children:m.title}),m.read&&m.dateRead&&!i&&e.jsxs("span",{className:"chapter-date",children:["(Read: ",m.dateRead,")"]})]},S))}),i&&e.jsx("div",{className:"delete-mode-notice",children:"Click on the trash can icons to delete chapters"})]})})]})},F=({message:s,onConfirm:t,onCancel:a,confirmText:n="Confirm",cancelText:r="Cancel"})=>e.jsx("div",{className:"confirmation-dialog-overlay",children:e.jsxs("div",{className:"confirmation-dialog",children:[e.jsx("p",{children:s}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{onClick:t,className:"confirm-button",children:n}),e.jsx("button",{onClick:a,className:"cancel-button",children:r})]})]})}),E=()=>{const[s,t]=h.useState(!1),[a,n]=h.useState(null);return{isOpen:s,askConfirmation:(i,d,u,c)=>{t(!0),n({message:i,onConfirm:d,confirmText:u,cancelText:c})},handleConfirm:()=>{a==null||a.onConfirm(),t(!1)},handleCancel:()=>{t(!1)},config:a}},A=({story:s,onSave:t,onCancel:a,onDelete:n})=>{const[r,o]=h.useState({title:(s==null?void 0:s.title)||"",coverImage:(s==null?void 0:s.coverRelativePath)||"",summary:(s==null?void 0:s.summary)||"",homepageURL:(s==null?void 0:s.homepageURL)||"",checkForUpdates:(s==null?void 0:s.checkForUpdates)||!1}),{isOpen:l,askConfirmation:i,handleConfirm:d,handleCancel:u,config:c}=E(),w=p=>{const{name:v,value:x}=p.target;o(j=>({...j,[v]:x}))},C=p=>{const{name:v,checked:x}=p.target;o(j=>({...j,[v]:x}))},k=()=>{if(!r.title.trim()){i("Title is required. Please enter a title before saving.",()=>{},"OK","");return}const p=s?"save edits to":"create new story",v=s?s.title:"New Story";i(`Are you sure you want to ${p} "${r.title||v}"?`,()=>{if(s)s.editStory({...r,coverImage:r.coverImage,homepageURL:r.homepageURL}),t(s);else{const x=U.empty();x.editStory(r),t(x)}},s?"Save":"Create","Cancel")},N=()=>{if(!s){a();return}i(`Are you sure you want to delete ${s.title}?`,n,"Delete","Cancel")};return e.jsxs("div",{className:"edit-story-panel",children:[e.jsx("h2",{children:s?"Edit Story":"Create New Story"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Title:"}),e.jsx("input",{type:"text",name:"title",value:r.title,onChange:w,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cover Image Path:"}),e.jsx("input",{type:"text",name:"coverImage",value:r.coverImage,onChange:w})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Summary:"}),e.jsx("textarea",{name:"summary",value:r.summary,onChange:w,rows:5})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Homepage URL:"}),e.jsx("input",{type:"text",name:"homepageURL",value:r.homepageURL,onChange:w})]}),e.jsx("div",{className:"form-group checkbox",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"checkForUpdates",checked:r.checkForUpdates,onChange:C}),"Check for Updates"]})}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{onClick:k,className:"save-button",children:s?"Save":"Create"}),e.jsx("button",{onClick:a,className:"cancel-button",children:"Cancel"}),s&&e.jsx("button",{onClick:N,className:"delete-button",children:"Delete Story"}),l&&c&&e.jsx(F,{message:c.message,onConfirm:d,onCancel:u,confirmText:c.confirmText,cancelText:c.cancelText})]})]})},K=({story:s,refreshGrid:t,onDelete:a})=>{const[n,r]=h.useState("detail"),{library:o,updateLibrary:l}=D(),i=d=>{l(),t(),r("detail")};return e.jsx("div",{className:"story-view-container",children:n==="detail"?e.jsx(Y,{story:s,onEdit:()=>r("edit"),refreshGrid:t}):n==="edit"?e.jsx(A,{story:s,onSave:i,onCancel:()=>r("detail"),onDelete:a}):e.jsx("h1",{children:" Story Deleted "})})},V=({story:s,onClick:t,onToggleUpdates:a,onChapterClick:n})=>{const r=s.getLastReadChapter(),o=s.getLastKnownChapter(),l=s.getFirstUnread(),i=()=>s.finished()?s.checkForUpdates?"finished-updates":"finished-no-updates":s.checkForUpdates?"unfinished-updates":"unfinished-no-updates",d=()=>{l&&n(l)},u=c=>{c.stopPropagation(),a(s)};return e.jsxs("div",{className:`story-widget ${i()}`,onClick:()=>t(s),children:[e.jsx("div",{className:"cover-container",children:s.coverPath?e.jsx("img",{src:`${s.coverPath}`,alt:s.title,className:"cover-image",onError:c=>{c.target.style.display="none"}}):e.jsx("div",{className:"no-cover",children:"[No Cover]"})}),e.jsxs("div",{className:"info-container",children:[e.jsx("h3",{className:"story-title",children:s.title}),e.jsx("button",{className:"updates-button",onClick:u,children:s.checkForUpdates?"Disable Updates":"Enable Updates"}),r&&e.jsxs("div",{className:`chapter-link ${r.url?"clickable":""}`,onClick:c=>{r.url&&(c.stopPropagation(),n(r))},children:["Last Read: ",r.title]}),o&&e.jsxs("div",{className:`chapter-link ${o.url?"clickable":""}`,onClick:c=>{o.url&&(c.stopPropagation(),n(o))},children:["Last Updated: ",o.title]}),e.jsx("button",{className:"read-button",onClick:c=>{c.stopPropagation(),d()},disabled:!l,children:l?"Read Next":"All Read"})]})]})},q=({stories:s,onStoryClick:t,onToggleUpdates:a,onChapterClick:n})=>{const r=h.useMemo(()=>{const o=[],l=[],i=[],d=[];for(const u of s)u.finished()?u.checkForUpdates?l.push(u):d.push(u):u.checkForUpdates?o.push(u):i.push(u);return[...o,...l,...i,...d]},[s]);return e.jsx("div",{className:"story-grid",children:r.map(o=>e.jsx(V,{story:o,onClick:t,onToggleUpdates:a,onChapterClick:n},o.title))})},X=({mainComponent:s,sideComponent:t,onClose:a,defaultSideWindowWidth:n=400})=>{const[r,o]=h.useState(!0),[l,i]=h.useState(n),d=h.useRef(!1),u=h.useRef(0),c=h.useRef(0),w=h.useRef(null),C=h.useRef(null),k=v=>{d.current=!0,u.current=v.clientX,c.current=l,document.addEventListener("mousemove",N),document.addEventListener("mouseup",p)},N=v=>{if(!d.current)return;const x=c.current+(u.current-v.clientX),j=Math.max(200,Math.min(window.innerWidth-200,x));i(j)},p=()=>{d.current=!1,document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",p)};return h.useEffect(()=>()=>{document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",p)},[]),h.useEffect(()=>{i(n),o(!!t)},[t]),e.jsxs("div",{className:"multi-window-container",style:{display:"flex",height:"100vh",overflow:"hidden"},children:[e.jsx("div",{ref:w,className:"main-window",style:{flex:1,overflowY:"auto",width:r?`calc(100% - ${l}px)`:"100%",transition:"width 0.2s ease"},children:s}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"resize-handle",onMouseDown:k,style:{width:"5px",cursor:"col-resize",backgroundColor:"#ddd",height:"100%"}}),e.jsxs("div",{ref:C,className:"side-window",style:{width:`${l}px`,height:"100%",overflowY:"auto",backgroundColor:"#f5f5f5",borderLeft:"1px solid #ccc",position:"relative"},children:[e.jsx("button",{onClick:a,style:{position:"absolute",top:"10px",right:"10px",background:"#ff5f56",border:"none",borderRadius:"50%",width:"16px",height:"16px",cursor:"pointer",zIndex:100},title:"Close window"}),e.jsx("div",{style:{padding:"20px"},children:t})]})]})]})},G=({stories:s,onDelete:t})=>{const{isOpen:a,askConfirmation:n,handleConfirm:r,handleCancel:o,config:l}=E(),i=d=>{n(`Are you sure you want to save delete to ${d.title}?`,()=>t(d),"Delete","Cancel")};return e.jsxs("div",{className:"delete-story-container",children:[a&&l&&e.jsx(F,{message:l.message,onConfirm:r,onCancel:o,confirmText:l.confirmText,cancelText:l.cancelText}),e.jsx("h2",{children:"Select Stories to Delete"}),e.jsx("div",{className:"stories-list",children:s.length===0?e.jsx("p",{children:"No stories available"}):e.jsx("ul",{children:s.map(d=>e.jsxs("li",{className:"story-item",children:[e.jsxs("div",{className:"story-info",children:[e.jsx("h3",{children:d.title}),d.coverPath&&e.jsx("img",{src:`/images/${d.coverPath}`,alt:`Cover for ${d.title}`,className:"story-cover"}),e.jsxs("div",{className:"story-stats",children:[e.jsxs("div",{children:[" Chapters: ",d.chapters.length," "]}),e.jsxs("div",{children:[" Read: ",d.chapters.filter(u=>u.read).length," "]}),e.jsxs("div",{children:[" ",d.finished()?" Finished":" In Progress"," "]})]})]}),e.jsx("button",{onClick:()=>i(d),className:"delete-button",children:"Delete"})]},d.title))})})]})},H=({stories:s,onFinish:t,onCancel:a})=>{const[n,r]=h.useState(0),[o,l]=h.useState("Starting..."),[i,d]=h.useState([]),[u,c]=h.useState(!1),{isOpen:w,askConfirmation:C,handleConfirm:k,handleCancel:N,config:p}=E();h.useEffect(()=>{if(u||n>=s.length)return;const j=setTimeout(async()=>{const g=s[n];if(l(`Checking: ${g.title}`),!g.checkForUpdates){r(f=>f+1);return}try{const y=(await window.electronAPI.checkStoryUpdate(g.serialize())).map(m=>new R(m));y.length>0&&d(m=>[...m,{type:"success",story:g,chapters:y}])}catch(f){let y="";if(f!=null&&f.message){const m=f.message.match(/Error:\s*(.*)$/);y=m?m[1]:f.message}else y=String(f);d(m=>[...m,{type:"error",story:g,error:y}])}finally{r(f=>f+1)}},200);return()=>clearTimeout(j)},[n,s,u]),h.useEffect(()=>{if(n>=s.length&&!u)if(c(!0),i.length===0)l("No updates found");else{const x=i.filter(j=>j.type==="success").reduce((j,g)=>j+g.chapters.length,0);l(`Found ${x} new chapters in ${i.length} stories`)}},[n,s.length,u,i]);const v=()=>{C("Are you sure you want to add the new chapters?",()=>{t(i.filter(x=>x.type==="success").map(x=>({story:x.story,chapters:x.chapters})))},"Add Chapters","Cancel")};return e.jsxs("div",{className:"update-panel",children:[w&&p&&e.jsx(F,{message:p.message,onConfirm:k,onCancel:N,confirmText:p.confirmText,cancelText:p.cancelText}),e.jsx("h3",{children:"Checking for Updates"}),e.jsx("div",{className:"progress-container",children:e.jsx("progress",{value:n,max:s.length})}),e.jsx("span",{children:o}),e.jsx("div",{className:"results",children:i.map((x,j)=>x.type==="success"?e.jsxs("div",{className:"result success",children:[e.jsxs("strong",{children:[x.story.title," - ",x.chapters.length," new chapter(s)"]}),e.jsx("ul",{children:x.chapters.map((g,f)=>e.jsx("li",{children:g.title},f))})]},j):e.jsxs("div",{className:"result error",children:[e.jsxs("strong",{children:[x.story.title," - Error"]}),e.jsx("p",{children:x.error})]},j))}),u&&e.jsxs("div",{className:"update-buttons",children:[e.jsx("button",{className:"save-updates",onClick:v,children:"Save"}),e.jsx("button",{className:"cancel-updates",onClick:a,children:"Cancel"})]})]})},B=()=>{const{library:s,loadLibrary:t,updateLibrary:a}=D(),[n,r]=h.useState(!0),[o,l]=h.useState([]),[i,d]=h.useState(U.empty()),[u,c]=h.useState("none");if(h.useEffect(()=>{(async()=>{try{const f=await t();l(f.stories)}catch(f){console.error("Failed to load library:",f)}finally{r(!1)}})()},[]),n)return e.jsx("div",{children:"Loading library..."});const w=g=>{d(g),c("detail")},C=()=>{c("none")},k=g=>{g.checkForUpdates=!g.checkForUpdates,a(),l([...o])},N=g=>{g.openLink(),a(),l([...o])},p=g=>{s.deleteStory(g),a(),l([...s.stories])},v=g=>{s.deleteStory(g),a(),l([...s.stories]),c("none")},x=g=>{g.forEach(f=>{f.story.newChapters(f.chapters)}),a(),l([...o]),c("none")},j=g=>{s.addStory(g),a(),l([...s.stories]),c("none")};return e.jsxs("div",{className:"main-view",children:[e.jsxs("div",{className:"main-view-button-container",children:[e.jsx("button",{onClick:()=>c("update"),className:"main-view-button",children:"Check For Updates"}),e.jsx("button",{onClick:()=>c("add"),className:"main-view-button",children:"Add Story"}),e.jsx("button",{onClick:()=>c("delete"),className:"main-view-button",children:"Delete Story"})]}),e.jsx(X,{mainComponent:e.jsx(q,{stories:o,onStoryClick:w,onToggleUpdates:k,onChapterClick:N}),sideComponent:u=="detail"?e.jsx(K,{story:i,refreshGrid:()=>l([...o]),onDelete:()=>v(i)}):u=="delete"?e.jsx(G,{stories:o,onDelete:p}):u=="add"?e.jsx(A,{story:null,onSave:j,onCancel:()=>c("none"),onDelete:()=>console.error("Delete should be impossible")}):u=="update"?e.jsx(H,{stories:o,onFinish:x,onCancel:()=>c("none")}):null,onClose:C,defaultSideWindowWidth:u=="update"?750:400})]})};function J(){return e.jsx(M,{children:e.jsx(B,{})})}W.createRoot(document.getElementById("root")).render(e.jsx(z.StrictMode,{children:e.jsx(J,{})}));
