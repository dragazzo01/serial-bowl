import{r as a,j as e,C as R,u as y,S as U,a as T,b as F,L as A,c as P,R as $}from"./StoryGrid-zrUnPSIx.js";const I=({onSave:t,onCancel:p,totalChapters:i})=>{const[u,c]=a.useState(""),[j,r]=a.useState(""),[s,l]=a.useState("last"),[x,m]=a.useState(i+1),[b,f]=a.useState(""),w=o=>{if(!o)return"";const C=new Date(o),d=(C.getMonth()+1).toString(),v=(C.getDate()+1).toString(),h=C.getFullYear();return`${d}/${v}/${h}`},N=o=>{o.preventDefault();const C=R.new(u,j||null,w(b));t(C,s==="custom"?x-1:s==="last"?i:0)};return e.jsxs("div",{className:"add-chapter-form",children:[e.jsx("h3",{children:"Add New Chapter"}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Chapter Title*:"}),e.jsx("input",{type:"text",value:u,onChange:o=>c(o.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"URL:"}),e.jsx("input",{type:"url",value:j,onChange:o=>r(o.target.value),placeholder:"Optional"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Position:"}),e.jsxs("div",{className:"position-options",children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",checked:s==="first",onChange:()=>l("first")}),"First"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",checked:s==="last",onChange:()=>l("last")}),"Last"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",checked:s==="custom",onChange:()=>l("custom")}),"Custom:"]}),s==="custom"&&e.jsx("input",{type:"number",min:"1",max:i+1,value:x,onChange:o=>m(parseInt(o.target.value)),className:"custom-position-input"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date Published:"}),e.jsx("input",{type:"date",onChange:o=>f(o.target.value)})]}),e.jsxs("div",{className:"form-buttons",children:[e.jsx("button",{type:"button",onClick:p,className:"cancel-button",children:"Cancel"}),e.jsx("button",{type:"submit",className:"save-button",children:"Save Chapter"})]})]})]})},W=({story:t,onEdit:p,refreshGrid:i})=>{const[u,c]=a.useState(!1),[j,r]=a.useState(!1),[s,l]=a.useState(!1),[x,m]=a.useState(!1),{updateLibrary:b}=y(),f=()=>{r(!j),i(),b()},w=n=>{n.toggle(),f()},N=n=>{n.openLink(),f()},o=()=>{m(!0)},C=n=>{const S=t.chapters.indexOf(n);S!==-1&&(t.chapters.splice(S,1),f())},d=()=>{l(!s)},v=n=>{s||(t.chapters.forEach(S=>{S.read!==n&&S.toggle()}),f())},h=(n,S)=>{t.addChapter(n,S),f(),m(!1)},g=()=>{m(!1)},k=t.chapters.every(n=>n.read);return e.jsxs("div",{className:"detail-story-panel",children:[e.jsxs("div",{className:"cover-row",children:[t.coverPath?e.jsx("img",{src:`${t.coverPath}`,alt:"Cover",className:"cover-image",onError:n=>{const S=n.target;S.onerror=null,S.src="",S.className="cover-placeholder"}}):e.jsx("div",{className:"cover-placeholder",children:"[Cover not found]"}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{onClick:()=>p(),className:"action-button",children:"âœï¸ Edit"}),e.jsx("button",{onClick:()=>c(!u),className:"action-button",children:"ðŸ“– Chapters"}),t.homepageURL&&e.jsx("button",{onClick:()=>window.electronAPI.openExternal(t.homepageURL),className:"action-button",children:"Homepage"})]})]}),e.jsxs("div",{className:"story-details",children:[e.jsxs("h2",{className:"story-title",children:[t.title,!t.checkForUpdates&&e.jsx("span",{className:"not-updating",children:" (Not Updating)"})]}),e.jsx("p",{className:"story-summary",children:t.summary})]}),u&&e.jsx("div",{className:"chapters-section",children:x?e.jsx(I,{onSave:h,onCancel:g,totalChapters:t.chapters.length}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"chapters-header",children:[e.jsx("h3",{children:"Chapters:"}),!s&&e.jsx("button",{onClick:()=>v(!k),className:"chapters-action-button",children:k?"UNREAD ALL":"READ ALL"}),!s&&e.jsx("button",{onClick:o,className:"chapters-action-button",children:"Add Chapter"}),e.jsx("button",{onClick:d,className:`chapters-action-button ${s?"delete-mode-active":""}`,children:s?"Cancel Delete":"Delete Chapter"})]}),e.jsx("div",{className:"chapters-list",children:[...t.chapters].reverse().map((n,S)=>e.jsxs("div",{className:"chapter-item",children:[e.jsx("button",{onClick:()=>s?C(n):w(n),className:`chapter-toggle ${s?"delete-mode":""}`,children:s?"ðŸ—‘ï¸":n.read?"âœ“":"âœ—"}),e.jsx("span",{className:`chapter-title ${n.url?"has-link":""}`,onClick:()=>n.url&&!s&&N(n),children:n.title}),n.read&&n.dateRead&&!s&&e.jsxs("span",{className:"chapter-date",children:["(Read: ",n.dateRead,")"]})]},S))}),s&&e.jsx("div",{className:"delete-mode-notice",children:"Click on the trash can icons to delete chapters"})]})})]})},L=({message:t,onConfirm:p,onCancel:i,confirmText:u="Confirm",cancelText:c="Cancel"})=>e.jsx("div",{className:"confirmation-dialog-overlay",children:e.jsxs("div",{className:"confirmation-dialog",children:[e.jsx("p",{children:t}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{onClick:p,className:"confirm-button",children:u}),e.jsx("button",{onClick:i,className:"cancel-button",children:c})]})]})}),D=()=>{const[t,p]=a.useState(!1),[i,u]=a.useState(null);return{isOpen:t,askConfirmation:(s,l,x,m)=>{p(!0),u({message:s,onConfirm:l,confirmText:x,cancelText:m})},handleConfirm:()=>{i==null||i.onConfirm(),p(!1)},handleCancel:()=>{p(!1)},config:i}},E=({story:t,onSave:p,onCancel:i,onDelete:u})=>{const[c,j]=a.useState({title:(t==null?void 0:t.title)||"",coverImage:(t==null?void 0:t.coverRelativePath)||"",summary:(t==null?void 0:t.summary)||"",homepageURL:(t==null?void 0:t.homepageURL)||"",checkForUpdates:(t==null?void 0:t.checkForUpdates)||!1}),{isOpen:r,askConfirmation:s,handleConfirm:l,handleCancel:x,config:m}=D(),b=o=>{const{name:C,value:d}=o.target;j(v=>({...v,[C]:d}))},f=o=>{const{name:C,checked:d}=o.target;j(v=>({...v,[C]:d}))},w=()=>{if(!c.title.trim()){s("Title is required. Please enter a title before saving.",()=>{},"OK","");return}const o=t?"save edits to":"create new story",C=t?t.title:"New Story";s(`Are you sure you want to ${o} "${c.title||C}"?`,()=>{if(t)t.editStory({...c,coverImage:c.coverImage,homepageURL:c.homepageURL}),p(t);else{const d=U.empty();d.editStory(c),p(d)}},t?"Save":"Create","Cancel")},N=()=>{if(!t){i();return}s(`Are you sure you want to delete ${t.title}?`,u,"Delete","Cancel")};return e.jsxs("div",{className:"edit-story-panel",children:[e.jsx("h2",{children:t?"Edit Story":"Create New Story"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Title:"}),e.jsx("input",{type:"text",name:"title",value:c.title,onChange:b,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cover Image Path:"}),e.jsx("input",{type:"text",name:"coverImage",value:c.coverImage,onChange:b})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Summary:"}),e.jsx("textarea",{name:"summary",value:c.summary,onChange:b,rows:5})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Homepage URL:"}),e.jsx("input",{type:"text",name:"homepageURL",value:c.homepageURL,onChange:b})]}),e.jsx("div",{className:"form-group checkbox",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"checkForUpdates",checked:c.checkForUpdates,onChange:f}),"Check for Updates"]})}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{onClick:w,className:"save-button",children:t?"Save":"Create"}),e.jsx("button",{onClick:i,className:"cancel-button",children:"Cancel"}),t&&e.jsx("button",{onClick:N,className:"delete-button",children:"Delete Story"}),r&&m&&e.jsx(L,{message:m.message,onConfirm:l,onCancel:x,confirmText:m.confirmText,cancelText:m.cancelText})]})]})},M=({story:t,refreshGrid:p,onDelete:i})=>{const[u,c]=a.useState("detail"),{library:j,updateLibrary:r}=y(),s=l=>{r(),p(),c("detail")};return e.jsx("div",{className:"story-view-container",children:u==="detail"?e.jsx(W,{story:t,onEdit:()=>c("edit"),refreshGrid:p}):u==="edit"?e.jsx(E,{story:t,onSave:s,onCancel:()=>c("detail"),onDelete:i}):e.jsx("h1",{children:" Story Deleted "})})},O=({mainComponent:t,sideComponent:p,onClose:i,defaultSideWindowWidth:u=400})=>{const[c,j]=a.useState(!0),[r,s]=a.useState(u),l=a.useRef(!1),x=a.useRef(0),m=a.useRef(0),b=a.useRef(null),f=a.useRef(null),w=C=>{l.current=!0,x.current=C.clientX,m.current=r,document.addEventListener("mousemove",N),document.addEventListener("mouseup",o)},N=C=>{if(!l.current)return;const d=m.current+(x.current-C.clientX),v=Math.max(200,Math.min(window.innerWidth-200,d));s(v)},o=()=>{l.current=!1,document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",o)};return a.useEffect(()=>()=>{document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",o)},[]),a.useEffect(()=>{s(u),j(!!p)},[p]),e.jsxs("div",{className:"multi-window-container",style:{display:"flex",height:"100vh",overflow:"hidden"},children:[e.jsx("div",{ref:b,className:"main-window",style:{flex:1,overflowY:"auto",width:c?`calc(100% - ${r}px)`:"100%",transition:"width 0.2s ease"},children:t}),c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"resize-handle",onMouseDown:w,style:{width:"5px",cursor:"col-resize",backgroundColor:"#ddd",height:"100%"}}),e.jsxs("div",{ref:f,className:"side-window",style:{width:`${r}px`,height:"100%",overflowY:"auto",backgroundColor:"#f5f5f5",borderLeft:"1px solid #ccc",position:"relative"},children:[e.jsx("button",{onClick:i,style:{position:"absolute",top:"10px",right:"10px",background:"#ff5f56",border:"none",borderRadius:"50%",width:"16px",height:"16px",cursor:"pointer",zIndex:100},title:"Close window"}),e.jsx("div",{style:{padding:"20px"},children:p})]})]})]})},z=({stories:t,onDelete:p})=>{const{isOpen:i,askConfirmation:u,handleConfirm:c,handleCancel:j,config:r}=D(),s=l=>{u(`Are you sure you want to save delete to ${l.title}?`,()=>p(l),"Delete","Cancel")};return e.jsxs("div",{className:"delete-story-container",children:[i&&r&&e.jsx(L,{message:r.message,onConfirm:c,onCancel:j,confirmText:r.confirmText,cancelText:r.cancelText}),e.jsx("h2",{children:"Select Stories to Delete"}),e.jsx("div",{className:"stories-list",children:t.length===0?e.jsx("p",{children:"No stories available"}):e.jsx("ul",{children:t.map(l=>e.jsxs("li",{className:"story-item",children:[e.jsxs("div",{className:"story-info",children:[e.jsx("h3",{children:l.title}),l.coverPath&&e.jsx("img",{src:`/images/${l.coverPath}`,alt:`Cover for ${l.title}`,className:"story-cover"}),e.jsxs("div",{className:"story-stats",children:[e.jsxs("div",{children:[" Chapters: ",l.chapters.length," "]}),e.jsxs("div",{children:[" Read: ",l.chapters.filter(x=>x.read).length," "]}),e.jsxs("div",{children:[" ",l.finished()?" Finished":" In Progress"," "]})]})]}),e.jsx("button",{onClick:()=>s(l),className:"delete-button",children:"Delete"})]},l.title))})})]})},Y=({stories:t,onFinish:p,onCancel:i})=>{const[u,c]=a.useState(0),[j,r]=a.useState("Starting..."),[s,l]=a.useState([]),[x,m]=a.useState(!1),{isOpen:b,askConfirmation:f,handleConfirm:w,handleCancel:N,config:o}=D();a.useEffect(()=>{if(x||u>=t.length)return;const v=setTimeout(async()=>{const h=t[u];if(r(`Checking: ${h.title}`),!h.checkForUpdates){c(g=>g+1);return}try{const k=(await T.checkStoryUpdate(h.serialize())).map(n=>new R(n));k.length>0&&l(n=>[...n,{type:"success",story:h,chapters:k}])}catch(g){let k="";if(g!=null&&g.message){const n=g.message.match(/Error:\s*(.*)$/);k=n?n[1]:g.message}else k=String(g);l(n=>[...n,{type:"error",story:h,error:k}])}finally{c(g=>g+1)}},200);return()=>clearTimeout(v)},[u,t,x]),a.useEffect(()=>{if(u>=t.length&&!x)if(m(!0),s.length===0)r("No updates found");else{const d=s.filter(v=>v.type==="success").reduce((v,h)=>v+h.chapters.length,0);r(`Found ${d} new chapters in ${s.length} stories`)}},[u,t.length,x,s]);const C=()=>{f("Are you sure you want to add the new chapters?",()=>{p(s.filter(d=>d.type==="success").map(d=>({story:d.story,chapters:d.chapters})))},"Add Chapters","Cancel")};return e.jsxs("div",{className:"update-panel",children:[b&&o&&e.jsx(L,{message:o.message,onConfirm:w,onCancel:N,confirmText:o.confirmText,cancelText:o.cancelText}),e.jsx("h3",{children:"Checking for Updates"}),e.jsx("div",{className:"progress-container",children:e.jsx("progress",{value:u,max:t.length})}),e.jsx("span",{children:j}),e.jsx("div",{className:"results",children:s.map((d,v)=>d.type==="success"?e.jsxs("div",{className:"result success",children:[e.jsxs("strong",{children:[d.story.title," - ",d.chapters.length," new chapter(s)"]}),e.jsx("ul",{children:d.chapters.map((h,g)=>e.jsx("li",{children:h.title},g))})]},v):e.jsxs("div",{className:"result error",children:[e.jsxs("strong",{children:[d.story.title," - Error"]}),e.jsx("p",{children:d.error})]},v))}),x&&e.jsxs("div",{className:"update-buttons",children:[e.jsx("button",{className:"save-updates",onClick:C,children:"Save"}),e.jsx("button",{className:"cancel-updates",onClick:i,children:"Cancel"})]})]})},V=()=>{const{library:t,loadLibrary:p,updateLibrary:i}=y(),[u,c]=a.useState(!0),[j,r]=a.useState([]),[s,l]=a.useState(U.empty()),[x,m]=a.useState("none");if(a.useEffect(()=>{(async()=>{try{const g=await p();r(g.stories)}catch(g){console.error("Failed to load library:",g)}finally{c(!1)}})()},[]),u)return e.jsx("div",{children:"Loading library..."});const b=h=>{l(h),m("detail")},f=()=>{m("none")},w=h=>{h.checkForUpdates=!h.checkForUpdates,i(),r([...j])},N=h=>{h.openLink(),i(),r([...j])},o=h=>{t.deleteStory(h),i(),r([...t.stories])},C=h=>{t.deleteStory(h),i(),r([...t.stories]),m("none")},d=h=>{h.forEach(g=>{g.story.newChapters(g.chapters)}),i(),r([...j]),m("none")},v=h=>{t.addStory(h),i(),r([...t.stories]),m("none")};return e.jsxs("div",{className:"main-view",children:[e.jsxs("div",{className:"main-view-button-container",children:[e.jsx("button",{onClick:()=>m("update"),className:"main-view-button",children:"Check For Updates"}),e.jsx("button",{onClick:()=>m("add"),className:"main-view-button",children:"Add Story"}),e.jsx("button",{onClick:()=>m("delete"),className:"main-view-button",children:"Delete Story"})]}),e.jsx(O,{mainComponent:e.jsx(F,{stories:j,onStoryClick:b,onToggleUpdates:w,onChapterClick:N}),sideComponent:x=="detail"?e.jsx(M,{story:s,refreshGrid:()=>r([...j]),onDelete:()=>C(s)}):x=="delete"?e.jsx(z,{stories:j,onDelete:o}):x=="add"?e.jsx(E,{story:null,onSave:v,onCancel:()=>m("none"),onDelete:()=>console.error("Delete should be impossible")}):x=="update"?e.jsx(Y,{stories:j,onFinish:d,onCancel:()=>m("none")}):null,onClose:f,defaultSideWindowWidth:x=="update"?750:400})]})};function q(){return e.jsx(A,{children:e.jsx(V,{})})}P.createRoot(document.getElementById("root")).render(e.jsx($.StrictMode,{children:e.jsx(q,{})}));
